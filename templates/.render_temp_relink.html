<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playlist Rebuilt - Playlist Relinker</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
</head>
<body>
  <div class="container">
    <h2>Playlist rebuilt:</h2>
    <h1>{{ playlist_name }}</h1>

    <div class="stats">
      {{ total }} items: <span class="found">{{ found }} found</span>, <span class="missed">{{ not_found }} missed</span>
    </div>

    <a href="#" onclick="openSpotifyApp(event)" class="button">Open Playlist</a>

    <div class="track-list">
      {% for track in report_tracks %}
        <div class="track">
          <div class="track-original">{{ track.original }}</div>
          {% if track.found %}
            <div class="track-found">{{ track.found }}</div>
          {% else %}
            <div class="track-found" style="color: #FF6B6B;">Not found</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {% if error %}
      <div class="error">Error: {{ error }}</div>
    {% endif %}

    <a href="{{ url_for('link') }}" class="button" style="margin-top: 24px;">Rebuild one more</a>

    <div class="version">v1.10</div>
  </div>

  <script>
    function openSpotifyApp(event) {
      event.preventDefault();
      const spotifyUri = "{{ playlist_spotify_uri }}";
      const fallbackUrl = "{{ playlist_url }}";

      window.location.href = spotifyUri;
      setTimeout(() => {
        window.location.href = fallbackUrl;
      }, 1500);
    }
  </script>
</body>
</html>
<script>window.scrollTo(0, 0); setTimeout(function() { window.scrollTo(0, 0); },200)</script>